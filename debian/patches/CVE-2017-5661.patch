Description: CVE-2017-5661: Dont load DTDs
Origin: backport, https://svn.apache.org/r1769967
Bug: https://issues.apache.org/jira/browse/FOP-2668
Bug-Debian: https://bugs.debian.org/860567
--- a/src/java/org/apache/fop/cli/InputHandler.java
+++ b/src/java/org/apache/fop/cli/InputHandler.java
@@ -244,6 +244,7 @@
         SAXParserFactory spf = SAXParserFactory.newInstance();
         spf.setFeature("http://xml.org/sax/features/namespaces", true);
         spf.setFeature("http://apache.org/xml/features/xinclude", true);
+        spf.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
         XMLReader xr = spf.newSAXParser().getXMLReader();
         return xr;
     }
--- a/src/java/org/apache/fop/servlet/FopServlet.java
+++ b/src/java/org/apache/fop/servlet/FopServlet.java
@@ -96,6 +96,8 @@
     public void init() throws ServletException {
         this.uriResolver = new ServletContextURIResolver(getServletContext());
         this.transFactory = TransformerFactory.newInstance();
+        transFactory.setAttribute(javax.xml.XMLConstants.ACCESS_EXTERNAL_DTD, "");
+        transFactory.setAttribute(javax.xml.XMLConstants.ACCESS_EXTERNAL_STYLESHEET, "");
         this.transFactory.setURIResolver(this.uriResolver);
         //Configure FopFactory as desired
         // TODO: Double check this behaves properly!!
